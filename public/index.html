<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>void</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display:ital@0;1&family=DM+Mono:wght@300;400&display=swap" rel="stylesheet">
<link rel="icon" type="image/svg+xml" href="/void-icon.svg">
<style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  :root {
    --bg: #09090b;
    --surface: #111113;
    --surface2: #18181c;
    --border: rgba(255,255,255,0.06);
    --border-hi: rgba(255,255,255,0.1);
    --text: #e8e8e8;
    --muted: #444;
    --accent: #c8f0a0;
    --font-display: 'DM Serif Display', serif;
    --font-mono: 'DM Mono', monospace;
  }

  html, body { height: 100%; overflow: hidden; cursor: none; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: var(--font-mono);
    font-weight: 300;
    font-size: 13px;
  }

  .vignette {
    position: fixed;
    inset: 0;
    z-index: 0;
    pointer-events: none;
    background: radial-gradient(ellipse at center, transparent 40%, rgba(0,0,0,0.7) 100%);
  }

  canvas#bg {
    position: fixed;
    inset: 0;
    z-index: 0;
    pointer-events: none;
  }

  .cursor-glow {
    position: fixed;
    width: 280px;
    height: 280px;
    border-radius: 50%;
    pointer-events: none;
    z-index: 9998;
    transform: translate(-50%, -50%);
    background: radial-gradient(circle, rgba(220,230,255,0.032) 0%, transparent 70%);
    transition: opacity 0.3s ease;
    opacity: 0;
  }

  .cursor-dot {
    position: fixed;
    width: 6px;
    height: 6px;
    border-radius: 50%;
    background: rgba(255,255,255,0.9);
    pointer-events: none;
    z-index: 9999;
    transform: translate(-50%, -50%);
    box-shadow: 0 0 6px rgba(255,255,255,0.4);
    transition: opacity 0.3s;
    opacity: 0;
  }

  /* GEAR BUTTON */
  .gear-btn {
    position: fixed;
    bottom: 24px;
    right: 24px;
    z-index: 100;
    width: 40px;
    height: 40px;
    background: rgba(9,9,11,0.92);
    border: 1px solid rgba(200,240,160,0.18);
    border-radius: 11px;
    color: rgba(200,240,160,0.55);
    font-size: 16px;
    cursor: none;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s;
    backdrop-filter: blur(20px);
    opacity: 0;
    animation: fadeUp 0.7s ease forwards 0.9s, gearPulse 3s ease infinite 1.5s;
    box-shadow: 0 0 12px rgba(200,240,160,0.06), inset 0 1px 0 rgba(200,240,160,0.06);
  }
  .gear-btn:hover {
    color: var(--accent);
    border-color: rgba(200,240,160,0.35);
    box-shadow: 0 0 20px rgba(200,240,160,0.12), inset 0 1px 0 rgba(200,240,160,0.1);
  }
  @keyframes gearPulse {
    0%, 100% { box-shadow: 0 0 12px rgba(200,240,160,0.06), inset 0 1px 0 rgba(200,240,160,0.06); }
    50% { box-shadow: 0 0 22px rgba(200,240,160,0.14), inset 0 1px 0 rgba(200,240,160,0.08); }
  }

  /* SETTINGS MODAL */
  .settings-overlay {
    position: fixed;
    inset: 0;
    z-index: 200;
    background: rgba(0,0,0,0.6);
    backdrop-filter: blur(8px);
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.25s ease;
  }
  .settings-overlay.open {
    opacity: 1;
    pointer-events: all;
  }

  .settings-modal {
    position: fixed;
    bottom: 0;
    left: 50%;
    transform: translateX(-50%) translateY(100%);
    z-index: 201;
    width: min(580px, 96vw);
    max-height: 85vh;
    background: #0d0d0f;
    border: 1px solid var(--border);
    border-top-color: rgba(255,255,255,0.1);
    border-bottom: none;
    border-radius: 16px 16px 0 0;
    overflow-y: auto;
    transition: transform 0.35s cubic-bezier(0.32, 0.72, 0, 1);
    scrollbar-width: thin;
    scrollbar-color: rgba(255,255,255,0.06) transparent;
  }
  .settings-modal.open {
    transform: translateX(-50%) translateY(0);
  }

  .settings-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 20px 24px 16px;
    border-bottom: 1px solid var(--border);
    position: sticky;
    top: 0;
    background: #0d0d0f;
    z-index: 1;
  }

  .settings-title {
    font-family: var(--font-display);
    font-size: 1.3rem;
    color: var(--text);
    font-weight: 400;
  }

  .settings-close {
    width: 28px;
    height: 28px;
    background: rgba(24,24,28,0.9);
    border: 1px solid var(--border);
    border-radius: 7px;
    color: #666;
    font-size: 14px;
    cursor: none;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.15s;
  }
  .settings-close:hover { color: #f87171; border-color: rgba(248,113,113,0.2); }

  .settings-body {
    padding: 20px 24px 32px;
    display: flex;
    flex-direction: column;
    gap: 28px;
  }

  .settings-section-title {
    font-size: 10px;
    color: #333;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    margin-bottom: 12px;
    padding-left: 2px;
  }

  /* BACKGROUND PICKER */
  .bg-options {
    display: grid;
    grid-template-columns: repeat(5, 1fr);
    gap: 8px;
  }

  .bg-option {
    aspect-ratio: 16/10;
    border-radius: 8px;
    border: 1px solid var(--border);
    cursor: none;
    overflow: hidden;
    position: relative;
    transition: all 0.2s;
    background: var(--surface);
  }
  .bg-option:hover { border-color: rgba(255,255,255,0.15); transform: translateY(-1px); }
  .bg-option.active {
    border-color: rgba(200,240,160,0.4);
    box-shadow: 0 0 12px rgba(200,240,160,0.1);
  }
  .bg-option canvas {
    width: 100%;
    height: 100%;
    display: block;
  }
  .bg-option-label {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    padding: 4px 6px;
    font-size: 9px;
    color: rgba(255,255,255,0.5);
    letter-spacing: 0.05em;
    background: linear-gradient(transparent, rgba(0,0,0,0.7));
    text-align: center;
  }
  .bg-option.active .bg-option-label { color: var(--accent); }

  /* PANIC KEY */
  .panic-row {
    display: flex;
    gap: 8px;
    align-items: center;
  }

  .panic-key-display {
    width: 44px;
    height: 44px;
    background: rgba(13,13,15,0.85);
    border: 1px solid var(--border);
    border-top-color: var(--border-hi);
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: var(--font-mono);
    font-size: 14px;
    color: var(--accent);
    flex-shrink: 0;
    transition: all 0.2s;
  }
  .panic-key-display.listening {
    border-color: rgba(200,240,160,0.3);
    box-shadow: 0 0 12px rgba(200,240,160,0.08);
    color: #fff;
    animation: blink 0.8s ease infinite;
  }
  @keyframes blink {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.4; }
  }

  .panic-set-btn {
    padding: 10px 14px;
    background: rgba(13,13,15,0.85);
    border: 1px solid var(--border);
    border-top-color: var(--border-hi);
    border-radius: 8px;
    color: var(--muted);
    font-family: var(--font-mono);
    font-size: 11px;
    cursor: none;
    transition: all 0.15s;
    letter-spacing: 0.04em;
    white-space: nowrap;
    flex-shrink: 0;
  }
  .panic-set-btn:hover { color: #aaa; border-color: rgba(255,255,255,0.1); }
  .panic-set-btn.listening { color: var(--accent); border-color: rgba(200,240,160,0.2); }

  .panic-hint {
    font-size: 10px;
    color: #333;
    letter-spacing: 0.04em;
    line-height: 1.5;
  }

  /* CLOAK SECTION (moved from tab) */
  .cloak-label {
    font-size: 10px;
    color: #333;
    letter-spacing: 0.06em;
    text-transform: uppercase;
    margin-bottom: 6px;
    padding-left: 2px;
  }

  .cloak-presets {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 6px;
    margin-bottom: 10px;
  }

  .cloak-preset {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 5px;
    padding: 10px 6px;
    background: rgba(13,13,15,0.85);
    border: 1px solid var(--border);
    border-top-color: rgba(255,255,255,0.07);
    border-radius: 8px;
    color: var(--muted);
    font-family: var(--font-mono);
    font-size: 10px;
    cursor: none;
    transition: all 0.15s;
    letter-spacing: 0.03em;
    backdrop-filter: blur(16px);
  }
  .cloak-preset img {
    width: 20px;
    height: 20px;
    object-fit: contain;
    border-radius: 3px;
  }
  .cloak-preset:hover { color: #aaa; border-color: rgba(255,255,255,0.1); }
  .cloak-preset.active {
    background: rgba(200,240,160,0.07);
    border-color: rgba(200,240,160,0.2);
    border-top-color: rgba(200,240,160,0.3);
    color: var(--accent);
  }

  .app {
    position: relative;
    z-index: 1;
    height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
  }

  .wordmark {
    font-family: var(--font-display);
    font-size: clamp(2.5rem, 6vw, 4rem);
    font-weight: 400;
    letter-spacing: -0.02em;
    color: var(--text);
    margin-bottom: 10px;
    opacity: 0;
    transform: translateY(12px);
    animation: fadeUp 0.7s ease forwards 0.2s;
    text-shadow: 0 0 80px rgba(255,255,255,0.07);
  }

  .tagline {
    font-size: 11px;
    color: #666;
    letter-spacing: 0.14em;
    text-transform: uppercase;
    margin-bottom: 52px;
    opacity: 0;
    transform: translateY(8px);
    animation: fadeUp 0.7s ease forwards 0.4s;
  }

  @keyframes fadeUp {
    to { opacity: 1; transform: translateY(0); }
  }

  .tabs {
    display: flex;
    gap: 2px;
    background: rgba(13,13,15,0.85);
    border: 1px solid var(--border);
    border-top-color: var(--border-hi);
    border-radius: 10px;
    padding: 4px;
    margin-bottom: 20px;
    opacity: 0;
    animation: fadeUp 0.7s ease forwards 0.55s;
    backdrop-filter: blur(16px);
    box-shadow: 0 1px 0 rgba(255,255,255,0.03) inset, 0 8px 32px rgba(0,0,0,0.4);
  }

  .tab {
    padding: 7px 20px;
    border-radius: 7px;
    border: none;
    background: transparent;
    color: var(--muted);
    font-family: var(--font-mono);
    font-size: 12px;
    cursor: none;
    transition: color 0.18s ease;
    letter-spacing: 0.04em;
  }
  .tab:hover { color: #aaa; }
  .tab.active {
    background: var(--surface2);
    color: var(--text);
    border: 1px solid var(--border);
    border-top-color: rgba(255,255,255,0.09);
    box-shadow: 0 1px 0 rgba(255,255,255,0.04) inset;
  }

  .panel { display: none; }
  .panel.active {
    display: block;
    animation: panelIn 0.22s ease forwards;
  }

  @keyframes panelIn {
    from { opacity: 0; transform: translateY(4px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .proxy-panel { width: min(560px, 92vw); }

  .proxy-engine-row {
    display: flex;
    gap: 6px;
    margin-bottom: 10px;
  }

  .engine-btn {
    flex: 1;
    padding: 7px 10px;
    background: rgba(13,13,15,0.85);
    border: 1px solid var(--border);
    border-top-color: rgba(255,255,255,0.07);
    border-radius: 8px;
    color: var(--muted);
    font-family: var(--font-mono);
    font-size: 11px;
    cursor: none;
    transition: all 0.15s;
    letter-spacing: 0.04em;
    text-align: center;
    backdrop-filter: blur(16px);
  }
  .engine-btn:hover { color: #aaa; border-color: rgba(255,255,255,0.1); }
  .engine-btn.active {
    background: rgba(200,240,160,0.07);
    border-color: rgba(200,240,160,0.2);
    border-top-color: rgba(200,240,160,0.3);
    color: var(--accent);
  }

  .engine-label {
    font-size: 10px;
    color: #333;
    letter-spacing: 0.06em;
    text-transform: uppercase;
    margin-bottom: 6px;
    padding-left: 2px;
  }

  .proxy-bar {
    display: flex;
    align-items: center;
    background: rgba(13,13,15,0.85);
    border: 1px solid var(--border);
    border-top-color: var(--border-hi);
    border-radius: 10px;
    overflow: hidden;
    transition: border-color 0.2s, box-shadow 0.2s;
    backdrop-filter: blur(16px);
    box-shadow: 0 1px 0 rgba(255,255,255,0.03) inset, 0 8px 32px rgba(0,0,0,0.3);
  }
  .proxy-bar:focus-within {
    border-color: rgba(200,240,160,0.18);
    border-top-color: rgba(200,240,160,0.28);
  }

  .proxy-icon { padding: 0 14px; color: var(--muted); font-size: 15px; flex-shrink: 0; }

  .proxy-input {
    flex: 1;
    background: transparent;
    border: none;
    outline: none;
    color: var(--text);
    font-family: var(--font-mono);
    font-size: 13px;
    padding: 14px 0;
    font-weight: 300;
    cursor: none;
  }
  .proxy-input::placeholder { color: #3a3a3a; }

  .proxy-btn {
    padding: 10px 18px;
    margin: 4px;
    background: rgba(24,24,28,0.9);
    border: 1px solid var(--border);
    border-top-color: rgba(255,255,255,0.09);
    border-radius: 7px;
    color: #888;
    font-family: var(--font-mono);
    font-size: 12px;
    cursor: none;
    transition: all 0.15s;
    letter-spacing: 0.04em;
    white-space: nowrap;
  }
  .proxy-btn:hover {
    background: rgba(200,240,160,0.07);
    border-color: rgba(200,240,160,0.14);
    color: var(--accent);
  }

  .proxy-hint { margin-top: 10px; color: #333; font-size: 11px; letter-spacing: 0.04em; text-align: center; }

  .proxy-frame-wrap {
    margin-top: 18px;
    background: var(--surface);
    border: 1px solid var(--border);
    border-top-color: var(--border-hi);
    border-radius: 10px;
    overflow: hidden;
    height: 0;
    transition: height 0.3s ease;
    box-shadow: 0 1px 0 rgba(255,255,255,0.03) inset, 0 8px 40px rgba(0,0,0,0.5);
    position: relative;
  }
  .proxy-frame-wrap.open { height: 420px; }

  .proxy-frame-toolbar {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 8px 10px;
    border-bottom: 1px solid var(--border);
    background: rgba(13,13,15,0.9);
    position: relative;
    z-index: 2;
  }

  .proxy-frame-url {
    flex: 1;
    background: rgba(24,24,28,0.8);
    border: 1px solid var(--border);
    border-radius: 6px;
    padding: 5px 10px;
    color: #666;
    font-family: var(--font-mono);
    font-size: 11px;
    outline: none;
    cursor: none;
  }
  .proxy-frame-url::placeholder { color: #2a2a2a; }

  .proxy-mini-btn {
    padding: 5px 10px;
    background: rgba(24,24,28,0.8);
    border: 1px solid var(--border);
    border-radius: 6px;
    color: #555;
    font-family: var(--font-mono);
    font-size: 11px;
    cursor: none;
    transition: all 0.15s;
    white-space: nowrap;
  }
  .proxy-mini-btn:hover { color: var(--text); border-color: rgba(255,255,255,0.1); }

  #proxyFrameContainer {
    position: absolute;
    top: 41px;
    left: 0;
    right: 0;
    bottom: 0;
  }
  #proxyFrameContainer iframe {
    width: 100%;
    height: 100%;
    border: none;
    cursor: auto;
  }

  .games-panel { width: min(860px, 95vw); }

  .games-search-bar {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 16px;
  }

  .games-search-input {
    flex: 1;
    background: rgba(13,13,15,0.85);
    border: 1px solid var(--border);
    border-top-color: var(--border-hi);
    border-radius: 9px;
    outline: none;
    color: var(--text);
    font-family: var(--font-mono);
    font-size: 12px;
    padding: 10px 14px;
    font-weight: 300;
    backdrop-filter: blur(16px);
    transition: border-color 0.2s;
  }
  .games-search-input::placeholder { color: #3a3a3a; }
  .games-search-input:focus { border-color: rgba(200,240,160,0.2); }

  .games-sort {
    background: rgba(13,13,15,0.85);
    border: 1px solid var(--border);
    border-top-color: var(--border-hi);
    border-radius: 9px;
    outline: none;
    color: #666;
    font-family: var(--font-mono);
    font-size: 12px;
    padding: 10px 12px;
    cursor: none;
    backdrop-filter: blur(16px);
  }

  .games-grid-wrap {
    background: rgba(13,13,15,0.7);
    border: 1px solid var(--border);
    border-top-color: var(--border-hi);
    border-radius: 12px;
    padding: 14px;
    backdrop-filter: blur(16px);
    box-shadow: 0 1px 0 rgba(255,255,255,0.03) inset, 0 8px 40px rgba(0,0,0,0.4);
    max-height: 52vh;
    overflow-y: auto;
    scrollbar-width: thin;
    scrollbar-color: rgba(255,255,255,0.06) transparent;
  }

  .games-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
    gap: 10px;
  }

  .game-card {
    background: rgba(24,24,28,0.8);
    border: 1px solid var(--border);
    border-top-color: rgba(255,255,255,0.07);
    border-radius: 9px;
    overflow: hidden;
    cursor: none;
    transition: border-color 0.2s, transform 0.2s, box-shadow 0.2s;
  }
  .game-card:hover {
    border-color: rgba(200,240,160,0.18);
    transform: translateY(-2px);
    box-shadow: 0 8px 24px rgba(0,0,0,0.4);
  }
  .game-card.special-card {
    border-color: rgba(88,101,242,0.2);
    background: rgba(88,101,242,0.06);
  }
  .game-card.special-card:hover {
    border-color: rgba(88,101,242,0.4);
    box-shadow: 0 8px 24px rgba(88,101,242,0.15);
  }
  .game-card img {
    width: 100%;
    aspect-ratio: 1;
    object-fit: cover;
    display: block;
    background: var(--surface2);
  }
  .special-card-icon {
    width: 100%;
    aspect-ratio: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 32px;
    background: rgba(88,101,242,0.08);
  }
  .game-card-name {
    padding: 8px 8px 9px;
    font-size: 11px;
    color: #999;
    text-align: center;
    line-height: 1.3;
    letter-spacing: 0.02em;
  }
  .game-card:hover .game-card-name { color: var(--text); }
  .special-card .game-card-name { color: #7289da; }
  .special-card:hover .game-card-name { color: #99aab5; }

  .games-loading {
    text-align: center;
    color: #333;
    font-size: 12px;
    padding: 40px;
    letter-spacing: 0.08em;
    text-transform: uppercase;
  }

  .game-viewer {
    position: fixed;
    inset: 0;
    z-index: 500;
    background: var(--bg);
    display: none;
    flex-direction: column;
  }
  .game-viewer.open { display: flex; }

  .game-viewer-bar {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 10px 16px;
    background: rgba(13,13,15,0.95);
    border-bottom: 1px solid var(--border);
    backdrop-filter: blur(16px);
    flex-shrink: 0;
  }
  .game-viewer-title { flex: 1; font-size: 13px; color: var(--text); letter-spacing: 0.04em; }
  .game-viewer-author { font-size: 11px; color: var(--muted); letter-spacing: 0.04em; }
  .game-viewer-btn {
    padding: 7px 14px;
    background: rgba(24,24,28,0.9);
    border: 1px solid var(--border);
    border-top-color: rgba(255,255,255,0.09);
    border-radius: 7px;
    color: #888;
    font-family: var(--font-mono);
    font-size: 11px;
    cursor: none;
    transition: all 0.15s;
    letter-spacing: 0.04em;
    white-space: nowrap;
  }
  .game-viewer-btn:hover { color: var(--text); border-color: rgba(255,255,255,0.12); }
  .game-viewer-btn.close-btn:hover { color: #f87171; border-color: rgba(248,113,113,0.2); }
  .game-viewer iframe { flex: 1; border: none; width: 100%; cursor: auto; }

  .status-row {
    margin-top: 36px;
    display: flex;
    gap: 24px;
    align-items: center;
    justify-content: center;
    color: #333;
    font-size: 11px;
    letter-spacing: 0.08em;
    opacity: 0;
    animation: fadeUp 0.7s ease forwards 0.7s;
  }

  .dot {
    width: 5px; height: 5px;
    border-radius: 50%;
    background: var(--accent);
    display: inline-block;
    margin-right: 6px;
    box-shadow: 0 0 6px rgba(200,240,160,0.5);
    animation: pulse 2.5s ease infinite;
  }
  @keyframes pulse {
    0%, 100% { opacity: 1; box-shadow: 0 0 6px rgba(200,240,160,0.5); }
    50% { opacity: 0.4; box-shadow: 0 0 3px rgba(200,240,160,0.15); }
  }

  .error-msg { margin-top: 8px; color: #f87171; font-size: 11px; text-align: center; display: none; }

  /* panic flash */
  .panic-flash {
    position: fixed;
    inset: 0;
    z-index: 99999;
    background: #fff;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.1s;
  }
  .panic-flash.go { opacity: 1; }
</style>
</head>
<body>

<canvas id="bg"></canvas>
<div class="vignette"></div>
<div class="cursor-glow" id="cursorGlow"></div>
<div class="cursor-dot" id="cursorDot"></div>
<div class="panic-flash" id="panicFlash"></div>

<!-- SETTINGS MODAL -->
<div class="settings-overlay" id="settingsOverlay"></div>
<div class="settings-modal" id="settingsModal">
  <div class="settings-header">
    <span class="settings-title">settings</span>
    <button class="settings-close" id="settingsClose">Ã—</button>
  </div>
  <div class="settings-body">

    <!-- BACKGROUND -->
    <div>
      <div class="settings-section-title">background</div>
      <div class="bg-options" id="bgOptions">
        <div class="bg-option active" data-bg="particles" id="prev-particles">
          <canvas id="prev-canvas-particles"></canvas>
          <div class="bg-option-label">particles</div>
        </div>
        <div class="bg-option" data-bg="rain" id="prev-rain">
          <canvas id="prev-canvas-rain"></canvas>
          <div class="bg-option-label">rain</div>
        </div>
        <div class="bg-option" data-bg="matrix" id="prev-matrix">
          <canvas id="prev-canvas-matrix"></canvas>
          <div class="bg-option-label">matrix</div>
        </div>
        <div class="bg-option" data-bg="starfield" id="prev-starfield">
          <canvas id="prev-canvas-starfield"></canvas>
          <div class="bg-option-label">starfield</div>
        </div>
        <div class="bg-option" data-bg="dots" id="prev-dots">
          <canvas id="prev-canvas-dots"></canvas>
          <div class="bg-option-label">dots</div>
        </div>
      </div>
    </div>

    <!-- PANIC KEY -->
    <div>
      <div class="settings-section-title">panic key</div>
      <div style="margin-bottom:10px;">
        <div class="panic-row">
          <div class="panic-key-display" id="panicKeyDisplay">?</div>
          <button class="panic-set-btn" id="panicSetBtn">press to set key</button>
          <span class="panic-hint">instantly navigates away<br>and clears history</span>
        </div>
      </div>
      <div class="cloak-label" style="margin-top:12px;">escape url</div>
      <div class="proxy-bar">
        <span class="proxy-icon" style="font-size:13px;">âŒ•</span>
        <input class="proxy-input" id="panicUrl" type="text" placeholder="https://clever.com" autocomplete="off" spellcheck="false">
      </div>
    </div>

    <!-- CLOAK -->
    <div>
      <div class="settings-section-title">tab cloak</div>
      <div class="cloak-label">tab name</div>
      <div class="proxy-bar" style="margin-bottom:10px;">
        <span class="proxy-icon" style="font-size:13px;">âœŽ</span>
        <input class="proxy-input" id="cloakTitle" type="text" placeholder="e.g. Google Classroom" autocomplete="off" spellcheck="false">
      </div>
      <div class="cloak-label">favicon preset</div>
      <div class="cloak-presets" id="cloakPresets">
        <button class="cloak-preset" data-title="Google Classroom" data-icon="https://ssl.gstatic.com/classroom/favicon.png">
          <img src="https://ssl.gstatic.com/classroom/favicon.png" alt=""> classroom
        </button>
        <button class="cloak-preset" data-title="Google Docs" data-icon="https://ssl.gstatic.com/docs/documents/images/kix-favicon7.ico">
          <img src="https://ssl.gstatic.com/docs/documents/images/kix-favicon7.ico" alt=""> docs
        </button>
        <button class="cloak-preset" data-title="Google Drive" data-icon="https://ssl.gstatic.com/images/branding/product/1x/drive_2020q4_32dp.png">
          <img src="https://ssl.gstatic.com/images/branding/product/1x/drive_2020q4_32dp.png" alt=""> drive
        </button>
        <button class="cloak-preset" data-title="Khan Academy" data-icon="/favicons/khan.ico">
          <img src="/favicons/khan.ico" alt=""> khan academy
        </button>
        <button class="cloak-preset" data-title="Quizlet" data-icon="/favicons/quizlet.ico">
          <img src="/favicons/quizlet.ico" alt=""> quizlet
        </button>
        <button class="cloak-preset" data-title="Duolingo" data-icon="/favicons/duolingo.ico">
          <img src="/favicons/duolingo.ico" alt=""> duolingo
        </button>
        <button class="cloak-preset" data-title="Desmos" data-icon="/favicons/desmos.ico">
          <img src="/favicons/desmos.ico" alt=""> desmos
        </button>
        <button class="cloak-preset" data-title="Clever | Portal" data-icon="/favicons/clever.ico">
          <img src="/favicons/clever.ico" alt=""> clever
        </button>
        <button class="cloak-preset" data-title="Choose a subject, i-Ready" data-icon="/favicons/iready.ico">
          <img src="/favicons/iready.ico" alt=""> i-ready
        </button>
        <button class="cloak-preset" data-title="NoodleTools - Projects" data-icon="/favicons/noodletools.ico">
          <img src="/favicons/noodletools.ico" alt=""> noodletools
        </button>
        <button class="cloak-preset" data-title="Schoology" data-icon="/favicons/schoology.ico">
          <img src="/favicons/schoology.ico" alt=""> schoology
        </button>
        <button class="cloak-preset active" data-title="void" data-icon="/void-icon.svg">
          <img src="/void-icon.svg" alt=""> void
        </button>
      </div>
      <div class="cloak-label" style="margin-top:10px;">custom icon url</div>
      <div class="proxy-bar" style="margin-bottom:12px;">
        <span class="proxy-icon" style="font-size:13px;">ðŸ”—</span>
        <input class="proxy-input" id="cloakIcon" type="text" placeholder="https://example.com/favicon.ico" autocomplete="off" spellcheck="false">
      </div>
      <button class="proxy-btn" id="applyCloak" style="width:100%;margin:0;padding:12px;">apply cloak</button>
      <button class="proxy-btn" id="resetCloak" style="width:100%;margin:4px 0 0;padding:10px;color:#555;">reset to void</button>
    </div>

  </div>
</div>

<!-- GEAR BUTTON -->
<button class="gear-btn" id="gearBtn">âš™</button>

<div class="game-viewer" id="gameViewer">
  <div class="game-viewer-bar">
    <div>
      <div class="game-viewer-title" id="gameViewerTitle">game</div>
      <div class="game-viewer-author" id="gameViewerAuthor"></div>
    </div>
    <button class="game-viewer-btn" id="gameFullscreenBtn">fullscreen</button>
    <button class="game-viewer-btn" id="gameNewTabBtn">new tab</button>
    <button class="game-viewer-btn close-btn" id="gameCloseBtn">close Ã—</button>
  </div>
  <iframe id="gameFrame"></iframe>
</div>

<div class="app" id="app">
  <div class="wordmark">void</div>
  <div class="tagline">your space between spaces</div>

  <div class="tabs">
    <button class="tab active" data-tab="proxy">proxy</button>
    <button class="tab" data-tab="games">games</button>
  </div>

  <div class="panel proxy-panel active" id="tab-proxy">
    <div class="engine-label">engine</div>
    <div class="proxy-engine-row">
      <button class="engine-btn active" data-engine="scramjet">scramjet</button>
      <button class="engine-btn" data-engine="uv">ultraviolet</button>
    </div>
    <div class="proxy-bar">
      <span class="proxy-icon">âŒ•</span>
      <input class="proxy-input" id="proxyUrl" type="text" placeholder="enter a url or search..." autocomplete="off" spellcheck="false">
      <button class="proxy-btn" id="goBtn">go â†’</button>
    </div>
    <div class="error-msg" id="errMsg"></div>
    <div class="proxy-hint">press enter to navigate</div>
    <div class="proxy-frame-wrap" id="frameWrap">
      <div class="proxy-frame-toolbar">
        <input class="proxy-frame-url" id="frameUrlBar" placeholder="navigating..." readonly>
        <button class="proxy-mini-btn" id="frameNewTab">new tab â†—</button>
        <button class="proxy-mini-btn" id="frameClose">close Ã—</button>
      </div>
      <div id="proxyFrameContainer"></div>
    </div>
  </div>

  <div class="panel games-panel" id="tab-games">
    <div class="games-search-bar">
      <input class="games-search-input" id="gamesSearch" type="text" placeholder="search games..." autocomplete="off" spellcheck="false">
      <select class="games-sort" id="gamesSort">
        <option value="name">name</option>
        <option value="popular">popular</option>
        <option value="id">newest</option>
      </select>
    </div>
    <div class="games-grid-wrap">
      <div class="games-grid" id="gamesGrid">
        <div class="games-loading">loading games...</div>
      </div>
    </div>
  </div>

  <div class="status-row">
    <span><span class="dot"></span>online</span>
  </div>
</div>

<script src="/scram/scramjet.all.js"></script>
<script src="/register-sw.js"></script>
<script type="module">
import { BareMuxConnection } from '/baremux/index.mjs';

const { ScramjetController } = $scramjetLoadController();
const scramjet = new ScramjetController({
  files: {
    wasm: '/scram/scramjet.wasm.wasm',
    all: '/scram/scramjet.all.js',
    sync: '/scram/scramjet.sync.js',
  },
});
scramjet.init('/sw.js');

const connection = new BareMuxConnection('/baremux/worker.js');

// â”€â”€â”€ BACKGROUND SYSTEM â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const canvas = document.getElementById('bg');
const ctx = canvas.getContext('2d');

let currentBg = localStorage.getItem('voidBg') || 'particles';
let bgAnimId = null;
let W, H;

function resize() {
  W = canvas.width = window.innerWidth;
  H = canvas.height = window.innerHeight;
}
window.addEventListener('resize', () => { resize(); startBg(currentBg); });
resize();

// shared mouse
let mouse = { x: -9999, y: -9999 };
window.addEventListener('mousemove', e => { mouse.x = e.clientX; mouse.y = e.clientY; });
window.addEventListener('mouseleave', () => { mouse.x = -9999; mouse.y = -9999; });

// â”€â”€ PARTICLES â”€â”€
let particles = [], tick = 0;
const TRAIL_LENGTH = 22;
const trail = Array.from({ length: TRAIL_LENGTH }, () => ({ x: -9999, y: -9999 }));
let trailIndex = 0;

function initParticles() {
  tick = 0; trailIndex = 0;
  trail.forEach(t => { t.x = -9999; t.y = -9999; });
  const count = Math.floor((W * H) / 7000);
  particles = Array.from({ length: count }, () => ({
    x: Math.random() * W, y: Math.random() * H,
    vx: (Math.random() - 0.5) * 0.15, vy: (Math.random() - 0.5) * 0.15,
    r: Math.random() * 1.4 + 0.4,
    ox: Math.random() * 1000, oy: Math.random() * 1000,
    freq: Math.random() * 0.0004 + 0.0002,
    amp: Math.random() * 0.25 + 0.1,
    bright: Math.random(),
  }));
}

function drawParticles() {
  tick++;
  ctx.clearRect(0, 0, W, H);
  trail[trailIndex] = { x: mouse.x, y: mouse.y };
  trailIndex = (trailIndex + 1) % TRAIL_LENGTH;
  for (let i = 0; i < TRAIL_LENGTH; i++) {
    const idx = (trailIndex - 1 - i + TRAIL_LENGTH) % TRAIL_LENGTH;
    const pt = trail[idx];
    if (pt.x === -9999) continue;
    const progress = 1 - i / TRAIL_LENGTH;
    ctx.beginPath();
    ctx.arc(pt.x, pt.y, progress * 3.5, 0, Math.PI * 2);
    ctx.fillStyle = `rgba(220,230,255,${progress * 0.35})`;
    ctx.fill();
  }
  for (let p of particles) {
    const dx = p.x - mouse.x, dy = p.y - mouse.y;
    const dist = Math.sqrt(dx * dx + dy * dy);
    const repel = 110;
    if (dist < repel && dist > 0) {
      const force = (repel - dist) / repel;
      p.vx += (dx / dist) * force * 0.6;
      p.vy += (dy / dist) * force * 0.6;
    }
    p.vx += Math.sin(tick * p.freq + p.ox) * p.amp * 0.012;
    p.vy += Math.cos(tick * p.freq + p.oy) * p.amp * 0.012;
    p.vx *= 0.97; p.vy *= 0.97;
    p.x += p.vx; p.y += p.vy;
    if (p.x < 0) p.x = W; if (p.x > W) p.x = 0;
    if (p.y < 0) p.y = H; if (p.y > H) p.y = 0;
    const proximity = Math.max(0, 1 - dist / 160);
    const alpha = 0.18 + p.bright * 0.18 + proximity * 0.45;
    const radius = p.r + proximity * 1.0;
    ctx.shadowBlur = proximity > 0.05 ? 6 + proximity * 10 : 0;
    ctx.shadowColor = `rgba(200,240,160,${proximity * 0.7})`;
    ctx.beginPath();
    ctx.arc(p.x, p.y, radius, 0, Math.PI * 2);
    ctx.fillStyle = `rgba(200,240,160,${alpha})`;
    ctx.fill();
  }
  ctx.shadowBlur = 0;
  const maxDist = 120;
  for (let i = 0; i < particles.length; i++) {
    for (let j = i + 1; j < particles.length; j++) {
      const a = particles[i], b = particles[j];
      const dx = a.x - b.x, dy = a.y - b.y;
      const d = Math.sqrt(dx * dx + dy * dy);
      if (d < maxDist) {
        ctx.beginPath(); ctx.moveTo(a.x, a.y); ctx.lineTo(b.x, b.y);
        ctx.strokeStyle = `rgba(200,240,160,${(1 - d / maxDist) * 0.09})`;
        ctx.lineWidth = 0.5; ctx.stroke();
      }
    }
  }
  bgAnimId = requestAnimationFrame(drawParticles);
}

// â”€â”€ RAIN â”€â”€ (click to burst)
let rainDrops = [], splashes = [];
function initRain() {
  splashes = [];
  const cols = Math.floor(W / 16);
  rainDrops = Array.from({ length: cols }, (_, i) => ({
    x: i * 16 + Math.random() * 8,
    y: Math.random() * -H,
    speed: Math.random() * 3 + 2,
    length: Math.floor(Math.random() * 14 + 6),
    opacity: Math.random() * 0.35 + 0.08,
    width: Math.random() * 0.8 + 0.3,
    wind: (Math.random() - 0.5) * 0.3,
  }));
}

function addSplash(x, y, count = 8) {
  for (let i = 0; i < count; i++) {
    const angle = (Math.PI * 2 * i / count) - Math.PI / 2;
    const speed = Math.random() * 3 + 1;
    splashes.push({
      x, y, vx: Math.cos(angle) * speed * (0.5 + Math.random()),
      vy: Math.sin(angle) * speed - 2,
      life: 1, decay: Math.random() * 0.04 + 0.03,
      r: Math.random() * 1.5 + 0.5,
    });
  }
}

function drawRain() {
  ctx.clearRect(0, 0, W, H);
  for (let d of rainDrops) {
    const grad = ctx.createLinearGradient(d.x, d.y - d.length * 10, d.x, d.y);
    grad.addColorStop(0, 'rgba(160,185,240,0)');
    grad.addColorStop(0.5, `rgba(170,195,245,${d.opacity * 0.4})`);
    grad.addColorStop(1, `rgba(200,215,255,${d.opacity})`);
    ctx.beginPath();
    ctx.moveTo(d.x, d.y - d.length * 10);
    ctx.lineTo(d.x + d.wind * d.length * 2, d.y);
    ctx.strokeStyle = grad; ctx.lineWidth = d.width; ctx.stroke();
    d.x += d.wind; d.y += d.speed * 5;
    if (d.y > H) {
      if (Math.random() < 0.3) addSplash(d.x, H - 2, 5);
      d.y = Math.random() * -200;
      d.speed = Math.random() * 3 + 2;
      d.opacity = Math.random() * 0.35 + 0.08;
      d.x = Math.random() * W;
    }
  }
  // draw splashes
  for (let i = splashes.length - 1; i >= 0; i--) {
    const s = splashes[i];
    ctx.beginPath();
    ctx.arc(s.x, s.y, s.r * s.life, 0, Math.PI * 2);
    ctx.fillStyle = `rgba(180,205,255,${s.life * 0.5})`;
    ctx.fill();
    s.x += s.vx; s.y += s.vy; s.vy += 0.15; s.life -= s.decay;
    if (s.life <= 0) splashes.splice(i, 1);
  }
  bgAnimId = requestAnimationFrame(drawRain);
}

// â”€â”€ MATRIX â”€â”€ (mouse proximity highlights nearby columns)
let matrixCols = [], matrixTick = 0;
const MATRIX_CHARS = 'ï½¦ï½§ï½¨ï½©ï½ªï½«ï½¬ï½­ï½®ï½¯ï½°ï½±ï½²ï½³ï½´ï½µï½¶ï½·ï½¸ï½¹ï½ºï½»ï½¼ï½½ï½¾ï½¿ï¾€ï¾ï¾‚ï¾ƒï¾„ï¾…ï¾†ï¾‡ï¾ˆï¾‰ï¾Šï¾‹ï¾Œï¾ï¾Žï¾ï¾ï¾‘ï¾’ï¾“ï¾”ï¾•ï¾–ï¾—ï¾˜ï¾™ï¾šï¾›ï¾œï¾0123456789';
const MATRIX_FS = 13;

function initMatrix() {
  matrixTick = 0;
  const cols = Math.floor(W / MATRIX_FS);
  matrixCols = Array.from({ length: cols }, () => {
    const len = Math.floor(Math.random() * 28 + 10);
    return {
      x: 0, // set below
      y: Math.random() * -80,
      speed: Math.random() * 0.6 + 0.15,
      chars: Array.from({ length: len }, () => MATRIX_CHARS[Math.floor(Math.random() * MATRIX_CHARS.length)]),
      baseOpacity: Math.random() * 0.22 + 0.04,
      updateTimer: 0,
      updateInterval: Math.floor(Math.random() * 6 + 3),
      glowIntensity: 0,
    };
  });
  // distribute with slight randomness in x
  matrixCols.forEach((col, i) => { col.x = i * MATRIX_FS + Math.random() * 3; });
}

function drawMatrix() {
  matrixTick++;
  ctx.fillStyle = 'rgba(9,9,11,0.1)';
  ctx.fillRect(0, 0, W, H);

  for (let col of matrixCols) {
    // mouse proximity boost
    const mdx = col.x - mouse.x;
    const proximity = Math.max(0, 1 - Math.abs(mdx) / 160);
    col.glowIntensity += (proximity * 1.2 - col.glowIntensity) * 0.08;

    col.updateTimer++;
    if (col.updateTimer >= col.updateInterval) {
      col.updateTimer = 0;
      const idx = Math.floor(Math.random() * col.chars.length);
      col.chars[idx] = MATRIX_CHARS[Math.floor(Math.random() * MATRIX_CHARS.length)];
    }

    const effectiveOpacity = col.baseOpacity + col.glowIntensity * 0.25;
    const effectiveSpeed = col.speed + col.glowIntensity * 0.8;

    ctx.font = `${MATRIX_FS}px 'DM Mono', monospace`;
    for (let j = 0; j < col.chars.length; j++) {
      const y = (col.y - j) * MATRIX_FS;
      if (y < -MATRIX_FS || y > H + MATRIX_FS) continue;
      const fade = Math.pow(1 - j / col.chars.length, 1.4);
      if (j === 0) {
        // bright head
        ctx.shadowBlur = col.glowIntensity > 0.3 ? 8 : 3;
        ctx.shadowColor = `rgba(200,255,160,0.8)`;
        ctx.fillStyle = `rgba(230,255,210,${Math.min(1, effectiveOpacity * 4)})`;
      } else if (j < 3) {
        ctx.shadowBlur = 0;
        ctx.fillStyle = `rgba(180,240,140,${effectiveOpacity * fade * 1.8})`;
      } else {
        ctx.shadowBlur = 0;
        ctx.fillStyle = `rgba(120,200,100,${effectiveOpacity * fade * 0.9})`;
      }
      ctx.fillText(col.chars[j], col.x, y);
    }
    ctx.shadowBlur = 0;

    col.y += effectiveSpeed;
    if ((col.y - col.chars.length) * MATRIX_FS > H) {
      col.y = -Math.random() * 40;
      col.speed = Math.random() * 0.6 + 0.15;
      col.baseOpacity = Math.random() * 0.22 + 0.04;
    }
  }
  bgAnimId = requestAnimationFrame(drawMatrix);
}

// â”€â”€ STARFIELD â”€â”€ (click to warp, mouse parallax)
let stars = [], shootingStars = [], warpParticles = [], starTick = 0;
function initStarfield() {
  starTick = 0; shootingStars = []; warpParticles = [];
  stars = Array.from({ length: 320 }, () => ({
    x: Math.random() * W, y: Math.random() * H,
    z: Math.random(),
    size: Math.random() * 1.6 + 0.2,
    bright: Math.random(),
    twinkle: Math.random() * Math.PI * 2,
    twinkleSpeed: Math.random() * 0.025 + 0.005,
    color: Math.random() > 0.85 ? [255, 220, 180] : Math.random() > 0.7 ? [180, 200, 255] : [215, 215, 235],
  }));
}

function spawnShootingStar() {
  shootingStars.push({
    x: Math.random() * W * 0.7,
    y: Math.random() * H * 0.4,
    vx: Math.random() * 6 + 4,
    vy: Math.random() * 3 + 1.5,
    life: 1,
    decay: 0.018,
    len: Math.floor(Math.random() * 60 + 30),
  });
}

function triggerWarp(cx, cy) {
  for (let i = 0; i < 60; i++) {
    const angle = Math.random() * Math.PI * 2;
    const speed = Math.random() * 5 + 1;
    warpParticles.push({
      x: cx, y: cy,
      vx: Math.cos(angle) * speed,
      vy: Math.sin(angle) * speed,
      life: 1, decay: Math.random() * 0.025 + 0.01,
      r: Math.random() * 1.5 + 0.3,
      color: Math.random() > 0.5 ? [200, 210, 255] : [255, 240, 200],
    });
  }
}

function drawStarfield() {
  starTick++;
  ctx.clearRect(0, 0, W, H);

  // faint nebula follows mouse
  if (mouse.x !== -9999) {
    const grad = ctx.createRadialGradient(mouse.x, mouse.y, 0, mouse.x, mouse.y, W * 0.35);
    grad.addColorStop(0, 'rgba(20,15,40,0.12)');
    grad.addColorStop(1, 'rgba(0,0,0,0)');
    ctx.fillStyle = grad; ctx.fillRect(0, 0, W, H);
  }

  // parallax offset
  const ox = mouse.x === -9999 ? 0 : (mouse.x - W/2) * 0.018;
  const oy = mouse.y === -9999 ? 0 : (mouse.y - H/2) * 0.018;

  // spawn shooting stars
  if (starTick % 280 === 0 && Math.random() < 0.6) spawnShootingStar();

  // draw stars
  for (let s of stars) {
    s.twinkle += s.twinkleSpeed;
    const tw = 0.55 + Math.sin(s.twinkle) * 0.45;
    const px = s.x + ox * s.z;
    const py = s.y + oy * s.z;
    const alpha = (0.25 + s.bright * 0.55) * tw;
    const r = s.size * (0.4 + s.bright * 0.7);
    if (s.bright > 0.75) {
      ctx.shadowBlur = 4 + s.bright * 6;
      ctx.shadowColor = `rgba(${s.color[0]},${s.color[1]},${s.color[2]},${alpha * 0.6})`;
    }
    ctx.beginPath();
    ctx.arc(px, py, r, 0, Math.PI * 2);
    ctx.fillStyle = `rgba(${s.color[0]},${s.color[1]},${s.color[2]},${alpha})`;
    ctx.fill();
    ctx.shadowBlur = 0;
  }

  // shooting stars
  for (let i = shootingStars.length - 1; i >= 0; i--) {
    const ss = shootingStars[i];
    const grad = ctx.createLinearGradient(ss.x - ss.vx * ss.len / 6, ss.y - ss.vy * ss.len / 6, ss.x, ss.y);
    grad.addColorStop(0, 'rgba(210,220,255,0)');
    grad.addColorStop(1, `rgba(230,235,255,${ss.life * 0.8})`);
    ctx.beginPath();
    ctx.moveTo(ss.x - ss.vx * ss.len / 6, ss.y - ss.vy * ss.len / 6);
    ctx.lineTo(ss.x, ss.y);
    ctx.strokeStyle = grad; ctx.lineWidth = ss.life * 1.5; ctx.stroke();
    ss.x += ss.vx; ss.y += ss.vy; ss.life -= ss.decay;
    if (ss.life <= 0) shootingStars.splice(i, 1);
  }

  // warp burst particles
  for (let i = warpParticles.length - 1; i >= 0; i--) {
    const p = warpParticles[i];
    ctx.beginPath();
    ctx.arc(p.x, p.y, p.r * p.life, 0, Math.PI * 2);
    ctx.fillStyle = `rgba(${p.color[0]},${p.color[1]},${p.color[2]},${p.life * 0.7})`;
    ctx.fill();
    p.x += p.vx; p.y += p.vy; p.life -= p.decay;
    if (p.life <= 0) warpParticles.splice(i, 1);
  }

  bgAnimId = requestAnimationFrame(drawStarfield);
}

// â”€â”€ DOT GRID â”€â”€ (mouse bulge)
let dotGrid = [], dotTick = 0;
const DOT_SPACING = 28;

function initDotGrid() {
  dotTick = 0; dotGrid = [];
  const cols = Math.ceil(W / DOT_SPACING) + 1;
  const rows = Math.ceil(H / DOT_SPACING) + 1;
  for (let r = 0; r < rows; r++) {
    for (let c = 0; c < cols; c++) {
      dotGrid.push({
        bx: c * DOT_SPACING, by: r * DOT_SPACING,
        x: c * DOT_SPACING, y: r * DOT_SPACING,
        baseR: Math.random() * 0.8 + 0.6,
        phase: Math.random() * Math.PI * 2,
        phaseSpeed: Math.random() * 0.004 + 0.001,
        baseAlpha: Math.random() * 0.12 + 0.06,
      });
    }
  }
}

function drawDotGrid() {
  dotTick++;
  ctx.clearRect(0, 0, W, H);
  const bulgeRadius = 140;
  const maxShift = 18;

  for (let d of dotGrid) {
    d.phase += d.phaseSpeed;
    const breathe = Math.sin(d.phase) * 0.3;

    let tx = d.bx, ty = d.by;
    let extraR = 0, extraAlpha = 0, greenTint = 0;

    if (mouse.x !== -9999) {
      const dx = d.bx - mouse.x, dy = d.by - mouse.y;
      const dist = Math.sqrt(dx * dx + dy * dy);
      if (dist < bulgeRadius && dist > 0) {
        const force = Math.pow(1 - dist / bulgeRadius, 2);
        tx = d.bx + (dx / dist) * force * maxShift;
        ty = d.by + (dy / dist) * force * maxShift;
        extraR = force * 2.8;
        extraAlpha = force * 0.5;
        greenTint = force;
      }
    }

    // smooth toward target
    d.x += (tx - d.x) * 0.12;
    d.y += (ty - d.y) * 0.12;

    const r = d.baseR + extraR + breathe;
    const alpha = d.baseAlpha + extraAlpha;

    if (greenTint > 0.1) {
      const g = Math.floor(170 + greenTint * 70);
      const gb = Math.floor(80 + greenTint * 80);
      ctx.fillStyle = `rgba(${Math.floor(180+greenTint*40)},${g},${gb},${alpha})`;
    } else {
      ctx.fillStyle = `rgba(180,185,195,${alpha})`;
    }

    ctx.beginPath();
    ctx.arc(d.x, d.y, Math.max(0.1, r), 0, Math.PI * 2);
    ctx.fill();
  }
  bgAnimId = requestAnimationFrame(drawDotGrid);
}

// â”€â”€ CLICK INTERACTIONS â”€â”€
canvas.style.pointerEvents = 'none'; // canvas doesn't need clicks â€” we listen on window
window.addEventListener('click', e => {
  if (document.getElementById('settingsModal').classList.contains('open')) return;
  if (currentBg === 'rain') addSplash(e.clientX, e.clientY, 14);
  else if (currentBg === 'starfield') triggerWarp(e.clientX, e.clientY);
});

function startBg(name) {
  if (bgAnimId) cancelAnimationFrame(bgAnimId);
  ctx.clearRect(0, 0, W, H);
  bgAnimId = null;
  currentBg = name;
  localStorage.setItem('voidBg', name);
  document.querySelectorAll('.bg-option').forEach(o => o.classList.toggle('active', o.dataset.bg === name));
  if (name === 'particles') { initParticles(); drawParticles(); }
  else if (name === 'rain') { initRain(); drawRain(); }
  else if (name === 'matrix') { initMatrix(); drawMatrix(); }
  else if (name === 'starfield') { initStarfield(); drawStarfield(); }
  else if (name === 'dots') { initDotGrid(); drawDotGrid(); }
}

// start saved bg
startBg(currentBg);

// â”€â”€â”€ PREVIEW THUMBNAILS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function drawPreview(canvasEl, type) {
  const w = canvasEl.width = canvasEl.offsetWidth || 120;
  const h = canvasEl.height = canvasEl.offsetHeight || 75;
  const c = canvasEl.getContext('2d');
  c.clearRect(0, 0, w, h);

  if (type === 'particles') {
    const pts = Array.from({ length: 18 }, () => ({ x: Math.random() * w, y: Math.random() * h }));
    pts.forEach(p => {
      c.beginPath(); c.arc(p.x, p.y, Math.random() * 1.2 + 0.4, 0, Math.PI * 2);
      c.fillStyle = `rgba(200,240,160,${Math.random() * 0.4 + 0.15})`; c.fill();
    });
    for (let i = 0; i < pts.length; i++) for (let j = i+1; j < pts.length; j++) {
      const d = Math.hypot(pts[i].x-pts[j].x, pts[i].y-pts[j].y);
      if (d < 35) { c.beginPath(); c.moveTo(pts[i].x, pts[i].y); c.lineTo(pts[j].x, pts[j].y);
        c.strokeStyle = `rgba(200,240,160,${(1-d/35)*0.15})`; c.lineWidth = 0.5; c.stroke(); }
    }
  } else if (type === 'rain') {
    for (let i = 0; i < 12; i++) {
      const x = Math.random() * w, len = Math.random() * 20 + 10;
      const y = Math.random() * h;
      const g = c.createLinearGradient(x, y-len, x, y);
      g.addColorStop(0, 'rgba(180,200,255,0)'); g.addColorStop(1, `rgba(200,220,255,${Math.random()*0.4+0.1})`);
      c.beginPath(); c.moveTo(x, y-len); c.lineTo(x, y);
      c.strokeStyle = g; c.lineWidth = 0.8; c.stroke();
    }
  } else if (type === 'matrix') {
    c.font = '8px monospace';
    for (let i = 0; i < 10; i++) {
      const x = Math.random() * w, y = Math.random() * h;
      c.fillStyle = `rgba(150,220,120,${Math.random()*0.3+0.1})`;
      c.fillText(MATRIX_CHARS[Math.floor(Math.random()*MATRIX_CHARS.length)], x, y);
    }
  } else if (type === 'starfield') {
    for (let i = 0; i < 30; i++) {
      c.beginPath(); c.arc(Math.random()*w, Math.random()*h, Math.random()*1.2+0.2, 0, Math.PI*2);
      c.fillStyle = `rgba(210,210,240,${Math.random()*0.6+0.2})`; c.fill();
    }
  } else if (type === 'dots') {
    const sp = 9;
    for (let r = sp/2; r < h; r += sp) {
      for (let col = sp/2; col < w; col += sp) {
        c.beginPath(); c.arc(col, r, 0.7, 0, Math.PI*2);
        c.fillStyle = `rgba(175,180,195,${Math.random()*0.1+0.07})`; c.fill();
      }
    }
  }
}

// draw previews after a tick so layout is done
setTimeout(() => {
  ['particles','rain','matrix','starfield','dots'].forEach(type => {
    const c = document.getElementById('prev-canvas-' + type);
    if (c) drawPreview(c, type);
  });
}, 100);

document.querySelectorAll('.bg-option').forEach(opt => {
  opt.addEventListener('click', () => startBg(opt.dataset.bg));
});

// â”€â”€â”€ CURSOR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const glowEl = document.getElementById('cursorGlow');
const dotEl = document.getElementById('cursorDot');
let glowPos = { x: -9999, y: -9999 };

function animCursor() {
  glowPos.x += (mouse.x - glowPos.x) * 0.18;
  glowPos.y += (mouse.y - glowPos.y) * 0.18;
  glowEl.style.left = glowPos.x + 'px';
  glowEl.style.top = glowPos.y + 'px';
  dotEl.style.left = mouse.x + 'px';
  dotEl.style.top = mouse.y + 'px';
  requestAnimationFrame(animCursor);
}
animCursor();

window.addEventListener('mousemove', () => { glowEl.style.opacity = '1'; dotEl.style.opacity = '1'; });
window.addEventListener('mouseleave', () => { glowEl.style.opacity = '0'; dotEl.style.opacity = '0'; });

// â”€â”€â”€ SETTINGS MODAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const gearBtn = document.getElementById('gearBtn');
const settingsModal = document.getElementById('settingsModal');
const settingsOverlay = document.getElementById('settingsOverlay');
const settingsClose = document.getElementById('settingsClose');

function openSettings() {
  settingsModal.classList.add('open');
  settingsOverlay.classList.add('open');
}
function closeSettings() {
  settingsModal.classList.remove('open');
  settingsOverlay.classList.remove('open');
}

gearBtn.addEventListener('click', openSettings);
settingsClose.addEventListener('click', closeSettings);
settingsOverlay.addEventListener('click', closeSettings);

// â”€â”€â”€ TABS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
document.querySelectorAll('.tab').forEach(tab => {
  tab.addEventListener('click', () => {
    const current = document.querySelector('.panel.active');
    if (current) {
      current.style.opacity = '0';
      current.style.transform = 'translateY(4px)';
      current.style.transition = 'opacity 0.15s ease, transform 0.15s ease';
      setTimeout(() => {
        current.classList.remove('active');
        current.style.transition = '';
        current.style.transform = '';
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        document.getElementById('tab-' + tab.dataset.tab).classList.add('active');
      }, 150);
    }
  });
});

document.querySelectorAll('.engine-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    document.querySelectorAll('.engine-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
  });
});

// â”€â”€â”€ PROXY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let sjFrame = null;

async function navigate() {
  let val = document.getElementById('proxyUrl').value.trim();
  if (!val) return;
  const errMsg = document.getElementById('errMsg');
  errMsg.style.display = 'none';
  if (!val.startsWith('http://') && !val.startsWith('https://')) {
    val = val.includes('.') && !val.includes(' ')
      ? 'https://' + val
      : 'https://www.google.com/search?q=' + encodeURIComponent(val);
  }
  const goBtn = document.getElementById('goBtn');
  goBtn.textContent = 'loading...';
  goBtn.disabled = true;
  try {
    await registerSW();
  } catch (err) {
    errMsg.textContent = 'SW error: ' + err.message;
    errMsg.style.display = 'block';
    goBtn.textContent = 'go â†’';
    goBtn.disabled = false;
    return;
  }
  try {
    const wispUrl = (location.protocol === 'https:' ? 'wss' : 'ws') + '://' + location.host + '/wisp/';
    if ((await connection.getTransport()) !== '/libcurl/index.mjs') {
      await connection.setTransport('/libcurl/index.mjs', [{ websocket: wispUrl }]);
    }
    const frameWrap = document.getElementById('frameWrap');
    const container = document.getElementById('proxyFrameContainer');
    document.getElementById('frameUrlBar').value = val;
    frameWrap.classList.add('open');
    container.innerHTML = '';
    sjFrame = scramjet.createFrame();
    sjFrame.frame.style.cssText = 'width:100%;height:100%;border:none;cursor:auto;';
    container.appendChild(sjFrame.frame);
    sjFrame.go(val);
  } catch (err) {
    errMsg.textContent = "couldn't load that page â€” try a different url";
    errMsg.style.display = 'block';
  }
  goBtn.textContent = 'go â†’';
  goBtn.disabled = false;
}

document.getElementById('goBtn').addEventListener('click', navigate);
document.getElementById('proxyUrl').addEventListener('keydown', e => { if (e.key === 'Enter') navigate(); });
document.getElementById('frameClose').addEventListener('click', () => {
  document.getElementById('frameWrap').classList.remove('open');
  document.getElementById('proxyFrameContainer').innerHTML = '';
  document.getElementById('frameUrlBar').value = '';
  sjFrame = null;
});
document.getElementById('frameNewTab').addEventListener('click', () => {
  if (sjFrame && sjFrame.frame.src) window.open(sjFrame.frame.src, '_blank');
});

// â”€â”€â”€ CLOAK â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let currentCloakIcon = '/void-icon.svg';

function setFavicon(url) {
  let link = document.querySelector("link[rel~='icon']");
  if (!link) { link = document.createElement('link'); link.rel = 'icon'; document.head.appendChild(link); }
  link.href = url;
}

const savedTitle = localStorage.getItem('voidCloakTitle');
const savedIcon = localStorage.getItem('voidCloakIcon');
if (savedTitle) document.title = savedTitle;
if (savedIcon) { setFavicon(savedIcon); currentCloakIcon = savedIcon; }

document.querySelectorAll('.cloak-preset').forEach(btn => {
  btn.addEventListener('click', () => {
    document.querySelectorAll('.cloak-preset').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    currentCloakIcon = btn.dataset.icon;
    document.getElementById('cloakTitle').value = btn.dataset.title;
    document.getElementById('cloakIcon').value = '';
  });
});

document.getElementById('cloakIcon').addEventListener('input', e => {
  if (e.target.value.trim()) {
    document.querySelectorAll('.cloak-preset').forEach(b => b.classList.remove('active'));
    currentCloakIcon = e.target.value.trim();
  }
});

document.getElementById('applyCloak').addEventListener('click', () => {
  const title = document.getElementById('cloakTitle').value.trim();
  const iconInput = document.getElementById('cloakIcon').value.trim();
  const icon = iconInput || currentCloakIcon;
  if (title) { document.title = title; localStorage.setItem('voidCloakTitle', title); }
  if (icon) { setFavicon(icon); localStorage.setItem('voidCloakIcon', icon); }
  const btn = document.getElementById('applyCloak');
  btn.textContent = 'applied âœ“';
  setTimeout(() => btn.textContent = 'apply cloak', 1500);
});

document.getElementById('resetCloak').addEventListener('click', () => {
  document.title = 'void';
  setFavicon('/void-icon.svg');
  localStorage.removeItem('voidCloakTitle');
  localStorage.removeItem('voidCloakIcon');
  document.getElementById('cloakTitle').value = '';
  document.getElementById('cloakIcon').value = '';
  document.querySelectorAll('.cloak-preset').forEach(b => b.classList.remove('active'));
  document.querySelector('.cloak-preset[data-title="void"]').classList.add('active');
  currentCloakIcon = '/void-icon.svg';
});

// â”€â”€â”€ PANIC KEY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let panicKey = localStorage.getItem('voidPanicKey') || '';
let panicUrl = localStorage.getItem('voidPanicUrl') || 'https://clever.com';
let listeningForKey = false;

const panicKeyDisplay = document.getElementById('panicKeyDisplay');
const panicSetBtn = document.getElementById('panicSetBtn');
const panicUrlInput = document.getElementById('panicUrl');

panicKeyDisplay.textContent = panicKey || '?';
panicUrlInput.value = panicUrl;

panicSetBtn.addEventListener('click', () => {
  listeningForKey = !listeningForKey;
  panicSetBtn.textContent = listeningForKey ? 'press any key...' : 'press to set key';
  panicSetBtn.classList.toggle('listening', listeningForKey);
  panicKeyDisplay.classList.toggle('listening', listeningForKey);
});

panicUrlInput.addEventListener('input', e => {
  panicUrl = e.target.value.trim() || 'https://clever.com';
  localStorage.setItem('voidPanicUrl', panicUrl);
});

window.addEventListener('keydown', e => {
  if (listeningForKey) {
    e.preventDefault();
    panicKey = e.key;
    localStorage.setItem('voidPanicKey', panicKey);
    panicKeyDisplay.textContent = panicKey.length === 1 ? panicKey : panicKey;
    listeningForKey = false;
    panicSetBtn.textContent = 'press to set key';
    panicSetBtn.classList.remove('listening');
    panicKeyDisplay.classList.remove('listening');
    return;
  }
  // fire panic
  if (panicKey && e.key === panicKey) {
    const flash = document.getElementById('panicFlash');
    flash.classList.add('go');
    setTimeout(() => {
      const url = panicUrl.startsWith('http') ? panicUrl : 'https://' + panicUrl;
      window.location.replace(url);
    }, 80);
  }
});

// â”€â”€â”€ GAMES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const COVER_URL = 'https://cdn.jsdelivr.net/gh/gn-math/covers@main';
const HTML_URL = 'https://cdn.jsdelivr.net/gh/gn-math/html@main';
const DISCORD_URL = 'https://discord.gg/gmb2RegMTd';
const SPECIAL_CARDS = [
  { id: 'void-discord', name: 'suggest games\n.gg/gmb2RegMTd', icon: 'ðŸ’¬', url: DISCORD_URL, external: true }
];
let allZones = [], popularityData = {};

async function loadGames() {
  try {
    const res = await fetch('https://cdn.jsdelivr.net/gh/gn-math/assets@main/zones.json?t=' + Date.now());
    const raw = await res.json();
    allZones = raw.filter(z => !z.name.startsWith('[!]'));
    try {
      const popRes = await fetch('https://data.jsdelivr.com/v1/stats/packages/gh/gn-math/html@main/files?period=year');
      const popData = await popRes.json();
      popData.forEach(file => {
        const match = file.name.match(/\/(\d+)\.html$/);
        if (match) popularityData[parseInt(match[1])] = file.hits.total;
      });
    } catch (e) {}
    renderGames(allZones);
  } catch (e) {
    document.getElementById('gamesGrid').innerHTML = '<div class="games-loading">failed to load games</div>';
  }
}

function sortZones(zones, sortBy) {
  const sorted = [...zones];
  if (sortBy === 'name') sorted.sort((a, b) => a.name.localeCompare(b.name));
  else if (sortBy === 'popular') sorted.sort((a, b) => (popularityData[b.id] || 0) - (popularityData[a.id] || 0));
  else if (sortBy === 'id') sorted.sort((a, b) => b.id - a.id);
  return sorted;
}

function renderGames(zones) {
  const grid = document.getElementById('gamesGrid');
  const sortBy = document.getElementById('gamesSort').value;
  const sorted = sortZones(zones, sortBy);
  const query = document.getElementById('gamesSearch').value.toLowerCase();
  grid.innerHTML = '';
  if (!query) SPECIAL_CARDS.forEach(card => grid.appendChild(makeSpecialCard(card)));
  if (!sorted.length) { grid.innerHTML += '<div class="games-loading">no games found</div>'; return; }
  sorted.forEach(zone => grid.appendChild(makeGameCard(zone)));
}

function makeSpecialCard(card) {
  const el = document.createElement('div');
  el.className = 'game-card special-card';
  el.addEventListener('click', () => window.open(card.url, '_blank'));
  const icon = document.createElement('div');
  icon.className = 'special-card-icon';
  icon.textContent = card.icon;
  const name = document.createElement('div');
  name.className = 'game-card-name';
  name.style.whiteSpace = 'pre-line';
  name.textContent = card.name;
  el.appendChild(icon);
  el.appendChild(name);
  return el;
}

function makeGameCard(zone) {
  const card = document.createElement('div');
  card.className = 'game-card';
  card.addEventListener('click', () => openGame(zone));
  const img = document.createElement('img');
  img.loading = 'lazy';
  img.alt = zone.name;
  img.src = zone.cover.replace('{COVER_URL}', COVER_URL).replace('{HTML_URL}', HTML_URL);
  const name = document.createElement('div');
  name.className = 'game-card-name';
  name.textContent = zone.name;
  card.appendChild(img);
  card.appendChild(name);
  return card;
}

async function openGame(zone) {
  const viewer = document.getElementById('gameViewer');
  const frame = document.getElementById('gameFrame');
  document.getElementById('gameViewerTitle').textContent = zone.name;
  document.getElementById('gameViewerAuthor').textContent = zone.author ? 'by ' + zone.author : '';
  if (zone.url.startsWith('http')) {
    frame.src = zone.url;
  } else {
    const url = zone.url.replace('{HTML_URL}', HTML_URL).replace('{COVER_URL}', COVER_URL);
    try {
      const res = await fetch(url + '?t=' + Date.now());
      const html = await res.text();
      frame.srcdoc = html;
    } catch (e) { frame.src = url; }
  }
  viewer.classList.add('open');
}

document.getElementById('gameCloseBtn').addEventListener('click', () => {
  document.getElementById('gameViewer').classList.remove('open');
  const frame = document.getElementById('gameFrame');
  frame.src = ''; frame.srcdoc = '';
});
document.getElementById('gameFullscreenBtn').addEventListener('click', () => {
  const frame = document.getElementById('gameFrame');
  if (frame.requestFullscreen) frame.requestFullscreen();
  else if (frame.webkitRequestFullscreen) frame.webkitRequestFullscreen();
});
document.getElementById('gameNewTabBtn').addEventListener('click', () => {
  const frame = document.getElementById('gameFrame');
  if (frame.src && frame.src !== window.location.href) {
    window.open(frame.src, '_blank');
  } else if (frame.srcdoc) {
    const w = window.open('about:blank', '_blank');
    w.document.open(); w.document.write(frame.srcdoc); w.document.close();
  }
});
document.getElementById('gamesSearch').addEventListener('input', e => {
  renderGames(allZones.filter(z => z.name.toLowerCase().includes(e.target.value.toLowerCase())));
});
document.getElementById('gamesSort').addEventListener('change', () => {
  const q = document.getElementById('gamesSearch').value.toLowerCase();
  renderGames(q ? allZones.filter(z => z.name.toLowerCase().includes(q)) : allZones);
});

loadGames();
</script>
</body>
</html>
